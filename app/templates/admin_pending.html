<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pending Approvals - Driven Dynamics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Montserrat',sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; position:relative; }
        .background-animation { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .shape { position:absolute; border-radius:50%; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .shape-1{ width:300px;height:300px; top:-100px; left:-100px; }
        .shape-2{ width:400px;height:400px; bottom:-150px; right:-150px; }
        .shape-3{ width:250px;height:250px; top:50%; left:50%; }

        .header { position: relative; z-index:10; padding:20px 40px; display:flex; justify-content:space-between; align-items:center; background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); }
        .logo { color:white; font-weight:700; display:flex; gap:10px; align-items:center; }
        .nav-menu { display:flex; gap:18px; }
        .nav-link { color:white; text-decoration:none; }

        .page-title { position: relative; z-index:10; text-align:center; padding:40px 20px; color:white; }
        .container-custom { position: relative; z-index:10; max-width:1400px; margin:0 auto; padding:20px 40px 80px; }

        .product-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(320px,1fr)); gap:24px; }
        .product-card { background: rgba(255,255,255,0.95); border-radius:16px; overflow:hidden; box-shadow: 0 8px 30px rgba(0,0,0,0.18); }
        .product-image { width:100%; height:220px; object-fit:cover; border-bottom: 3px solid #667eea; }
        .product-details { padding:18px; }
        .product-make { font-size:20px; color:#667eea; font-weight:700; }
        .seller-badge { font-size:12px; color:#764ba2; background: rgba(118,75,162,0.08); padding:4px 8px; border-radius:6px; display:inline-block; margin:8px 0; }
    .btn-action { flex: 1; padding: 12px; border-radius: 10px; font-weight: 600; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
    .btn-update { background: #667eea; color: white; }
    .btn-delete { background: #f5576c; color: white; }
    .btn-view { background: #444; color: white; }
    </style>
</head>
<body data-flashed='{{ get_flashed_messages() | tojson | safe }}'>
    <div class="background-animation">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <header class="header">
        <div class="logo"><i class="bi bi-shield-check"></i> <span>Admin Panel</span></div>
        <nav class="nav-menu">
            <a class="nav-link" href="/admin/pending">Pending</a>
            <a class="nav-link" href="/catelog">Catalog</a>
            <a class="nav-link" href="/logout">Logout</a>
        </nav>
    </header>

    <div class="page-title">
        <h1>Pending <span style="color:#ffd700;">Product Approvals</span></h1>
        <p style="color:rgba(255,255,255,0.9)">Approve items to appear on the buyer catalog.</p>
    </div>

    <div class="container-custom">
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <img src="{{ product.image_url }}" alt="{{ product.make }}" class="product-image">
                <div class="product-details">
                    <h3 class="product-make">{{ product.make }} {{ product.model }}</h3>
                    <div class="seller-badge"><i class="bi bi-person-circle"></i> Seller: {{ product.get('SellerEmail') }}</div>
                    <p class="product-description">{{ product.description }}</p>
                    <div style="display:flex; gap:10px; margin-top:12px; align-items:center;">
                        {% if product.get('reg_document_url') %}
                        <a href="{{ product.get('reg_document_url') }}" target="_blank" class="btn-action btn-update" style="background:#444; color:white; display:inline-flex; align-items:center; gap:8px;">
                            <i class="bi bi-file-earmark-arrow-down"></i> View Registration
                        </a>
                        {% endif %}

                        <form method="post" action="/admin/approve/{{ product.get('_id') }}" onsubmit="return confirmApprove(this)" style="flex:1;">
                            <button class="btn-action btn-update" type="submit"><i class="bi bi-check-circle"></i> Approve</button>
                        </form>
                        <form method="post" action="/delete_product" onsubmit="return confirmDelete(this)">
                            <input type="hidden" name="delete_id" value="{{ product.get('_id') }}">
                            <button class="btn-action btn-delete" type="submit"><i class="bi bi-trash-fill"></i> Delete</button>
                        </form>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="product-card" style="padding:24px;">
                <p>No pending products.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Show flashed messages using SweetAlert2 to match the sell_review popup style
        document.addEventListener('DOMContentLoaded', function() {
            const flashed = JSON.parse(document.body.getAttribute('data-flashed') || '[]');
            if (flashed && flashed.length) {
                flashed.forEach(msg => {
                    let icon = 'info';
                    const m = (msg || '').toLowerCase();
                    if (m.includes('success') || m.includes('approved')) icon = 'success';
                    else if (m.includes('warning') || m.includes('no product')) icon = 'warning';
                    else if (m.includes('error') || m.includes('invalid')) icon = 'error';

                    Swal.fire({
                        title: msg,
                        icon: icon,
                        confirmButtonColor: '#764ba2'
                    });
                });
            }
        });
        function getProductNameFromForm(form) {
            try {
                const card = form.closest('.product-card');
                if (!card) return '';
                const titleEl = card.querySelector('.product-make');
                return titleEl ? titleEl.innerText.trim() : '';
            } catch (e) {
                return '';
            }
        }

        function confirmApprove(form) {
            const name = getProductNameFromForm(form) || 'this product';
            return confirm(`Approve ${name}?\n\nThis will make the product visible to buyers.`);
        }

        function confirmDelete(form) {
            const name = getProductNameFromForm(form) || 'this product';
            return confirm(`Delete ${name}?\n\nThis action cannot be undone.`);
        }
    </script>
</html>
